ğŸ§  Fonctionnement

Lâ€™utilisateur tÃ©lÃ©charge son contrat depuis /api/loans/:id/contract (Ã§a marche dÃ©jÃ  âœ…).

Ensuite, il verra une zone â€œTÃ©lÃ©verser votre contrat signÃ©â€ avec :

un bouton Choisir un fichier ;

un bouton Envoyer ;

un message de confirmation en cas de succÃ¨s/Ã©chec.

Le fichier sera envoyÃ© via fetch vers ton endpoint /api/loans/:id/upload-signed-contract.

Le backend le stockera dans /uploads/signed_contracts/ et mettra Ã  jour loan.signedContractUrl dans la base de donnÃ©es.

ğŸ§© Code Ã  ajouter dans Dashboard.tsx
import React, { useState } from "react";

export default function Dashboard() {
  const [selectedFile, setSelectedFile] = useState<File | null>(null);
  const [uploadStatus, setUploadStatus] = useState<string>("");

  const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    if (e.target.files && e.target.files.length > 0) {
      setSelectedFile(e.target.files[0]);
      setUploadStatus("");
    }
  };

  const handleUpload = async () => {
    if (!selectedFile) {
      setUploadStatus("âŒ Veuillez choisir un fichier avant d'envoyer.");
      return;
    }

    const formData = new FormData();
    formData.append("file", selectedFile);

    try {
      const response = await fetch(`/api/loans/upload-signed-contract`, {
        method: "POST",
        body: formData,
        credentials: "include",
      });

      if (response.ok) {
        setUploadStatus("âœ… Contrat envoyÃ© avec succÃ¨s !");
        setSelectedFile(null);
      } else {
        setUploadStatus("âŒ Ã‰chec de lâ€™envoi du contrat.");
      }
    } catch (error) {
      console.error(error);
      setUploadStatus("âš ï¸ Une erreur est survenue.");
    }
  };

  return (
    <div className="contract-upload-container" style={{ padding: "1.5rem", background: "#f8f9fa", borderRadius: "12px", marginTop: "2rem" }}>
      <h3>ğŸ“„ TÃ©lÃ©verser votre contrat signÃ©</h3>
      <p>Veuillez envoyer ici votre contrat signÃ© (PDF, JPG ou PNG).</p>
      <input type="file" accept=".pdf,.jpg,.jpeg,.png" onChange={handleFileChange} />
      <button
        onClick={handleUpload}
        style={{
          marginLeft: "10px",
          background: "#007bff",
          color: "white",
          border: "none",
          padding: "10px 16px",
          borderRadius: "6px",
          cursor: "pointer",
        }}
      >
        Envoyer
      </button>

      {uploadStatus && (
        <p style={{ marginTop: "10px", fontWeight: "500", color: uploadStatus.includes("âœ…") ? "green" : "red" }}>
          {uploadStatus}
        </p>
      )}
    </div>
  );
}

âš™ï¸ Endpoint Backend (Node/Express)

Si non prÃ©sent, ajoute-le dans ton backend :

import express from "express";
import multer from "multer";
import fs from "fs";
const router = express.Router();

const upload = multer({ dest: "uploads/signed_contracts/" });

router.post("/api/loans/upload-signed-contract", upload.single("file"), async (req, res) => {
  try {
    const filePath = req.file.path;
    const fileName = req.file.originalname;

    // Mettre Ã  jour la BDD avec lâ€™URL du contrat signÃ©
    // Exemple :
    // await prisma.loan.update({
    //   where: { id: req.user.loanId },
    //   data: { signedContractUrl: `/uploads/signed_contracts/${fileName}` }
    // });

    res.status(200).json({ success: true, message: "Contrat signÃ© reÃ§u avec succÃ¨s âœ…" });
  } catch (error) {
    console.error(error);
    res.status(500).json({ success: false, message: "Erreur lors de lâ€™envoi du contrat" });
  }
});

export default router;

ğŸ§¾ RÃ©sumÃ©

âœ… TÃ©lÃ©chargement â†’ dÃ©jÃ  en place
âœ… Upload du contrat signÃ© â†’ ajoutÃ©
âœ… Stockage sÃ©curisÃ© et lisible â†’ OK
âœ… Message de confirmation â†’ OK
âœ… Aucun impact sur le reste du dashboard